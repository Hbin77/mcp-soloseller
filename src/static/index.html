<!DOCTYPE html>
<html lang="ko" x-data="app()" x-init="init()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑몰 자동화 MCP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .sidebar-link.active { background-color: rgb(59 130 246); color: white; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- 사이드바 -->
    <aside class="fixed left-0 top-0 z-40 h-screen w-64 bg-gray-900 text-white transition-transform"
           :class="{ '-translate-x-full': !sidebarOpen, 'translate-x-0': sidebarOpen }">
        <div class="flex h-16 items-center justify-center border-b border-gray-700">
            <h1 class="text-xl font-bold"><i class="ri-shopping-cart-2-line mr-2"></i>쇼핑몰 자동화</h1>
        </div>
        <nav class="p-4 space-y-2">
            <a href="#" @click.prevent="currentPage = 'dashboard'" 
               class="sidebar-link flex items-center gap-3 rounded-lg px-4 py-3 hover:bg-gray-800 transition"
               :class="{ 'active': currentPage === 'dashboard' }">
                <i class="ri-dashboard-line text-xl"></i>
                <span>대시보드</span>
            </a>
            <a href="#" @click.prevent="currentPage = 'orders'" 
               class="sidebar-link flex items-center gap-3 rounded-lg px-4 py-3 hover:bg-gray-800 transition"
               :class="{ 'active': currentPage === 'orders' }">
                <i class="ri-shopping-bag-line text-xl"></i>
                <span>주문 관리</span>
            </a>
            <a href="#" @click.prevent="currentPage = 'products'" 
               class="sidebar-link flex items-center gap-3 rounded-lg px-4 py-3 hover:bg-gray-800 transition"
               :class="{ 'active': currentPage === 'products' }">
                <i class="ri-archive-line text-xl"></i>
                <span>상품/재고</span>
            </a>
            <a href="#" @click.prevent="currentPage = 'claims'" 
               class="sidebar-link flex items-center gap-3 rounded-lg px-4 py-3 hover:bg-gray-800 transition"
               :class="{ 'active': currentPage === 'claims' }">
                <i class="ri-exchange-line text-xl"></i>
                <span>반품/교환</span>
            </a>
            <a href="#" @click.prevent="currentPage = 'settings'" 
               class="sidebar-link flex items-center gap-3 rounded-lg px-4 py-3 hover:bg-gray-800 transition"
               :class="{ 'active': currentPage === 'settings' }">
                <i class="ri-settings-3-line text-xl"></i>
                <span>설정</span>
            </a>
        </nav>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700">
            <div class="text-xs text-gray-400">
                <p>MCP Server v1.0.0</p>
                <p x-text="'마지막 동기화: ' + lastSync"></p>
            </div>
        </div>
    </aside>

    <!-- 메인 컨텐츠 -->
    <div class="ml-64">
        <!-- 헤더 -->
        <header class="sticky top-0 z-30 bg-white shadow-sm">
            <div class="flex h-16 items-center justify-between px-6">
                <button @click="sidebarOpen = !sidebarOpen" class="lg:hidden">
                    <i class="ri-menu-line text-2xl"></i>
                </button>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-500" x-text="new Date().toLocaleDateString('ko-KR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })"></span>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="refreshData()" class="flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600 transition">
                        <i class="ri-refresh-line"></i>
                        <span>새로고침</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- 페이지 컨텐츠 -->
        <main class="p-6">
            <!-- 대시보드 -->
            <div x-show="currentPage === 'dashboard'" x-cloak>
                <h2 class="text-2xl font-bold mb-6">대시보드</h2>
                
                <!-- 요약 카드 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">오늘 주문</p>
                                <p class="text-3xl font-bold text-gray-900" x-text="dashboard.today?.orders || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="ri-shopping-bag-line text-2xl text-blue-500"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">오늘 매출</p>
                                <p class="text-3xl font-bold text-gray-900" x-text="formatCurrency(dashboard.today?.sales || 0)"></p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="ri-money-won-circle-line text-2xl text-green-500"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">발송 대기</p>
                                <p class="text-3xl font-bold text-orange-500" x-text="dashboard.pending?.orders || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                                <i class="ri-truck-line text-2xl text-orange-500"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">재고 부족</p>
                                <p class="text-3xl font-bold" :class="dashboard.alerts?.low_stock > 0 ? 'text-red-500' : 'text-gray-900'" x-text="dashboard.alerts?.low_stock || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                <i class="ri-alert-line text-2xl text-red-500"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 채널별 현황 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">채널별 오늘 주문</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <span class="text-green-600 font-bold text-sm">N</span>
                                    </div>
                                    <span class="font-medium">스마트스토어</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold" x-text="(dashboard.today?.by_channel?.naver?.count || 0) + '건'"></p>
                                    <p class="text-sm text-gray-500" x-text="formatCurrency(dashboard.today?.by_channel?.naver?.total || 0)"></p>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                        <span class="text-red-600 font-bold text-sm">C</span>
                                    </div>
                                    <span class="font-medium">쿠팡</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold" x-text="(dashboard.today?.by_channel?.coupang?.count || 0) + '건'"></p>
                                    <p class="text-sm text-gray-500" x-text="formatCurrency(dashboard.today?.by_channel?.coupang?.total || 0)"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">배치 처리</h3>
                        <div class="space-y-4">
                            <button @click="processBatch(1)" class="w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <span class="text-blue-600 font-bold">1차</span>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-medium">1차 송장 처리</p>
                                        <p class="text-sm text-gray-500">12:00 스케줄</p>
                                    </div>
                                </div>
                                <i class="ri-play-circle-line text-2xl text-blue-500"></i>
                            </button>
                            <button @click="processBatch(2)" class="w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <span class="text-purple-600 font-bold">2차</span>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-medium">2차 송장 처리</p>
                                        <p class="text-sm text-gray-500">15:30 스케줄</p>
                                    </div>
                                </div>
                                <i class="ri-play-circle-line text-2xl text-purple-500"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 최근 주문 -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">최근 주문</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">채널</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문번호</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문자</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">금액</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">상태</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문일시</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="order in recentOrders" :key="order.id">
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="order.channel === 'naver' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                                                  x-text="order.channel === 'naver' ? '스마트스토어' : '쿠팡'"></span>
                                        </td>
                                        <td class="py-3 px-4 font-mono text-sm" x-text="order.channel_order_id"></td>
                                        <td class="py-3 px-4" x-text="order.buyer_name"></td>
                                        <td class="py-3 px-4 font-medium" x-text="formatCurrency(order.total_amount)"></td>
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="getStatusClass(order.status)"
                                                  x-text="getStatusText(order.status)"></span>
                                        </td>
                                        <td class="py-3 px-4 text-sm text-gray-500" x-text="formatDate(order.ordered_at)"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 주문 관리 -->
            <div x-show="currentPage === 'orders'" x-cloak>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">주문 관리</h2>
                    <button @click="collectOrders()" class="flex items-center gap-2 rounded-lg bg-green-500 px-4 py-2 text-white hover:bg-green-600 transition">
                        <i class="ri-download-line"></i>
                        <span>주문 수집</span>
                    </button>
                </div>

                <!-- 필터 -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="flex flex-wrap gap-4">
                        <select x-model="orderFilter.status" class="rounded-lg border-gray-300 text-sm">
                            <option value="">전체 상태</option>
                            <option value="new">신규</option>
                            <option value="confirmed">발주확인</option>
                            <option value="shipped">발송완료</option>
                            <option value="delivered">배송완료</option>
                        </select>
                        <select x-model="orderFilter.channel" class="rounded-lg border-gray-300 text-sm">
                            <option value="">전체 채널</option>
                            <option value="naver">스마트스토어</option>
                            <option value="coupang">쿠팡</option>
                        </select>
                        <input type="text" x-model="orderFilter.search" placeholder="검색..." 
                               class="rounded-lg border-gray-300 text-sm" @keyup.enter="loadOrders()">
                        <button @click="loadOrders()" class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm hover:bg-gray-700">
                            검색
                        </button>
                    </div>
                </div>

                <!-- 주문 목록 -->
                <div class="bg-white rounded-xl shadow-sm">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">채널</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문번호</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문자</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">수령인</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">금액</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">상태</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">송장번호</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문일시</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="order in orders" :key="order.id">
                                    <tr class="border-b hover:bg-gray-50 cursor-pointer" @click="showOrderDetail(order)">
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="order.channel === 'naver' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                                                  x-text="order.channel === 'naver' ? 'N' : 'C'"></span>
                                        </td>
                                        <td class="py-3 px-4 font-mono text-sm" x-text="order.channel_order_id"></td>
                                        <td class="py-3 px-4" x-text="order.buyer_name"></td>
                                        <td class="py-3 px-4" x-text="order.receiver_name"></td>
                                        <td class="py-3 px-4 font-medium" x-text="formatCurrency(order.total_amount)"></td>
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="getStatusClass(order.status)"
                                                  x-text="getStatusText(order.status)"></span>
                                        </td>
                                        <td class="py-3 px-4 font-mono text-sm" x-text="order.tracking_number || '-'"></td>
                                        <td class="py-3 px-4 text-sm text-gray-500" x-text="formatDate(order.ordered_at)"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <!-- 페이지네이션 -->
                    <div class="flex items-center justify-between px-4 py-3 border-t">
                        <p class="text-sm text-gray-500">
                            총 <span x-text="orderPagination.total"></span>건
                        </p>
                        <div class="flex gap-2">
                            <button @click="orderPagination.page > 1 && (orderPagination.page--, loadOrders())"
                                    :disabled="orderPagination.page <= 1"
                                    class="px-3 py-1 border rounded text-sm disabled:opacity-50">이전</button>
                            <span class="px-3 py-1 text-sm" x-text="orderPagination.page + ' / ' + orderPagination.pages"></span>
                            <button @click="orderPagination.page < orderPagination.pages && (orderPagination.page++, loadOrders())"
                                    :disabled="orderPagination.page >= orderPagination.pages"
                                    class="px-3 py-1 border rounded text-sm disabled:opacity-50">다음</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 상품/재고 관리 -->
            <div x-show="currentPage === 'products'" x-cloak>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">상품/재고 관리</h2>
                    <div class="flex gap-2">
                        <button @click="showAddProduct = true" class="flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600 transition">
                            <i class="ri-add-line"></i>
                            <span>상품 등록</span>
                        </button>
                        <button @click="syncStock()" class="flex items-center gap-2 rounded-lg bg-green-500 px-4 py-2 text-white hover:bg-green-600 transition">
                            <i class="ri-refresh-line"></i>
                            <span>채널 동기화</span>
                        </button>
                    </div>
                </div>

                <!-- 재고 부족 알림 -->
                <div x-show="lowStockProducts.length > 0" class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                    <div class="flex items-center gap-2 text-red-700 mb-2">
                        <i class="ri-alert-fill"></i>
                        <span class="font-semibold">재고 부족 상품</span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="p in lowStockProducts" :key="p.id">
                            <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">
                                <span x-text="p.name"></span>: <span x-text="p.stock_quantity"></span>개
                            </span>
                        </template>
                    </div>
                </div>

                <!-- 상품 목록 -->
                <div class="bg-white rounded-xl shadow-sm">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">SKU</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">상품명</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">재고</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">가격</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">채널 연동</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">작업</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="product in products" :key="product.id">
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4 font-mono text-sm" x-text="product.sku"></td>
                                        <td class="py-3 px-4" x-text="product.name"></td>
                                        <td class="py-3 px-4">
                                            <span class="font-bold" :class="product.is_low_stock ? 'text-red-500' : 'text-gray-900'"
                                                  x-text="product.stock_quantity + '개'"></span>
                                            <span x-show="product.is_low_stock" class="ml-2 text-xs text-red-500"><i class="ri-alert-line"></i> 부족</span>
                                        </td>
                                        <td class="py-3 px-4" x-text="formatCurrency(product.price)"></td>
                                        <td class="py-3 px-4">
                                            <span x-show="product.naver_product_id" class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded mr-1">N</span>
                                            <span x-show="product.coupang_product_id" class="px-2 py-1 text-xs bg-red-100 text-red-700 rounded">C</span>
                                        </td>
                                        <td class="py-3 px-4">
                                            <button @click="showStockUpdate(product)" class="text-blue-500 hover:text-blue-700 mr-2">
                                                <i class="ri-edit-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 클레임 관리 -->
            <div x-show="currentPage === 'claims'" x-cloak>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">반품/교환 관리</h2>
                    <button @click="syncClaims()" class="flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600 transition">
                        <i class="ri-refresh-line"></i>
                        <span>클레임 동기화</span>
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-sm">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">채널</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">주문번호</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">유형</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">사유</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">상태</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500">요청일시</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="claim in claims" :key="claim.claim_id">
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="claim.channel === 'naver' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                                                  x-text="claim.channel === 'naver' ? 'N' : 'C'"></span>
                                        </td>
                                        <td class="py-3 px-4 font-mono text-sm" x-text="claim.order_id"></td>
                                        <td class="py-3 px-4">
                                            <span class="px-2 py-1 text-xs font-medium rounded"
                                                  :class="{'bg-orange-100 text-orange-700': claim.type === 'return', 'bg-blue-100 text-blue-700': claim.type === 'exchange', 'bg-gray-100 text-gray-700': claim.type === 'cancel'}"
                                                  x-text="{'return': '반품', 'exchange': '교환', 'cancel': '취소'}[claim.type]"></span>
                                        </td>
                                        <td class="py-3 px-4 text-sm" x-text="claim.reason || '-'"></td>
                                        <td class="py-3 px-4 text-sm" x-text="claim.status"></td>
                                        <td class="py-3 px-4 text-sm text-gray-500" x-text="formatDate(claim.requested_at)"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 설정 -->
            <div x-show="currentPage === 'settings'" x-cloak>
                <h2 class="text-2xl font-bold mb-6">설정</h2>

                <div class="space-y-6">
                    <!-- 연결 상태 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">연결 상태</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="flex items-center gap-3 p-4 border rounded-lg">
                                <div class="w-3 h-3 rounded-full" :class="connectionStatus.naver?.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                                <div>
                                    <p class="font-medium">스마트스토어</p>
                                    <p class="text-sm text-gray-500" x-text="connectionStatus.naver?.message || '확인 중...'"></p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 p-4 border rounded-lg">
                                <div class="w-3 h-3 rounded-full" :class="connectionStatus.coupang?.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                                <div>
                                    <p class="font-medium">쿠팡</p>
                                    <p class="text-sm text-gray-500" x-text="connectionStatus.coupang?.message || '확인 중...'"></p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 p-4 border rounded-lg">
                                <div class="w-3 h-3 rounded-full" :class="connectionStatus.telegram?.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                                <div>
                                    <p class="font-medium">텔레그램</p>
                                    <p class="text-sm text-gray-500" x-text="connectionStatus.telegram?.message || '확인 중...'"></p>
                                </div>
                            </div>
                        </div>
                        <button @click="checkConnection()" class="mt-4 text-blue-500 hover:text-blue-700 text-sm">
                            <i class="ri-refresh-line mr-1"></i>연결 상태 확인
                        </button>
                    </div>

                    <!-- 네이버 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>네이버 스마트스토어 API</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client ID</label>
                                <input type="text" x-model="settingsForm.naver.client_id" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client Secret</label>
                                <input type="password" x-model="settingsForm.naver.client_secret" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Seller ID</label>
                                <input type="text" x-model="settingsForm.naver.seller_id" class="w-full rounded-lg border-gray-300">
                            </div>
                            <button @click="saveNaverSettings()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                저장
                            </button>
                        </div>
                    </div>

                    <!-- 쿠팡 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-2"></span>쿠팡 WING API</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Vendor ID</label>
                                <input type="text" x-model="settingsForm.coupang.vendor_id" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Access Key</label>
                                <input type="password" x-model="settingsForm.coupang.access_key" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Secret Key</label>
                                <input type="password" x-model="settingsForm.coupang.secret_key" class="w-full rounded-lg border-gray-300">
                            </div>
                            <button @click="saveCoupangSettings()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                저장
                            </button>
                        </div>
                    </div>

                    <!-- 텔레그램 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><i class="ri-telegram-line mr-2 text-blue-500"></i>텔레그램 알림</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bot Token</label>
                                <input type="password" x-model="settingsForm.telegram.bot_token" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Chat ID</label>
                                <input type="text" x-model="settingsForm.telegram.chat_id" class="w-full rounded-lg border-gray-300">
                            </div>
                            <button @click="saveTelegramSettings()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                저장 및 테스트
                            </button>
                        </div>
                    </div>

                    <!-- 스케줄 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><i class="ri-time-line mr-2 text-purple-500"></i>스케줄 설정</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">1차 송장 처리</label>
                                <input type="time" x-model="settingsForm.schedule.first_batch" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">2차 송장 처리</label>
                                <input type="time" x-model="settingsForm.schedule.second_batch" class="w-full rounded-lg border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">배송 추적 간격(분)</label>
                                <input type="number" x-model="settingsForm.schedule.tracking_interval" class="w-full rounded-lg border-gray-300">
                            </div>
                        </div>
                        <button @click="saveScheduleSettings()" class="mt-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                            저장
                        </button>
                    </div>

                    <!-- 발송인 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><i class="ri-user-location-line mr-2 text-indigo-500"></i>발송인 정보</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">이름</label>
                                <input type="text" x-model="settingsForm.sender.name" class="w-full rounded-lg border-gray-300" placeholder="홍길동">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">연락처</label>
                                <input type="text" x-model="settingsForm.sender.phone" class="w-full rounded-lg border-gray-300" placeholder="010-1234-5678">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">우편번호</label>
                                <input type="text" x-model="settingsForm.sender.zipcode" class="w-full rounded-lg border-gray-300" placeholder="12345">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">주소</label>
                                <input type="text" x-model="settingsForm.sender.address" class="w-full rounded-lg border-gray-300" placeholder="서울시 강남구 테헤란로 123">
                            </div>
                        </div>
                        <button @click="saveSenderSettings()" class="mt-4 px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600">
                            저장
                        </button>
                    </div>

                    <!-- 택배사 설정 -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4"><i class="ri-truck-line mr-2 text-orange-500"></i>택배사 설정</h3>

                        <!-- 기본 택배사 선택 -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">기본 택배사</label>
                            <select x-model="settingsForm.defaultCarrier" @change="saveDefaultCarrier()" class="w-full md:w-64 rounded-lg border-gray-300">
                                <option value="cj">CJ대한통운</option>
                                <option value="hanjin">한진택배</option>
                                <option value="lotte">롯데택배</option>
                                <option value="logen">로젠택배</option>
                                <option value="epost">우체국택배</option>
                            </select>
                        </div>

                        <!-- CJ대한통운 -->
                        <div class="border rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <span class="w-3 h-3 rounded-full" :class="carrierStatus.cj?.configured ? 'bg-green-500' : 'bg-gray-300'"></span>
                                    <span class="font-medium">CJ대한통운</span>
                                    <span x-show="settingsForm.defaultCarrier === 'cj'" class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">기본</span>
                                </div>
                                <span class="text-sm text-gray-500" x-text="carrierStatus.cj?.configured ? '설정됨' : '미설정'"></span>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Customer ID</label>
                                    <input type="text" x-model="settingsForm.carriers.cj.customer_id" class="w-full rounded-lg border-gray-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                                    <input type="password" x-model="settingsForm.carriers.cj.api_key" class="w-full rounded-lg border-gray-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">계약코드 (선택)</label>
                                    <input type="text" x-model="settingsForm.carriers.cj.contract_code" class="w-full rounded-lg border-gray-300">
                                </div>
                                <button @click="saveCarrierSettings('cj')" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                                    저장
                                </button>
                            </div>
                        </div>

                        <!-- 한진택배 -->
                        <div class="border rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <span class="w-3 h-3 rounded-full" :class="carrierStatus.hanjin?.configured ? 'bg-green-500' : 'bg-gray-300'"></span>
                                    <span class="font-medium">한진택배</span>
                                    <span x-show="settingsForm.defaultCarrier === 'hanjin'" class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">기본</span>
                                    <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">추후 지원</span>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Customer ID</label>
                                    <input type="text" x-model="settingsForm.carriers.hanjin.customer_id" class="w-full rounded-lg border-gray-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                                    <input type="password" x-model="settingsForm.carriers.hanjin.api_key" class="w-full rounded-lg border-gray-300">
                                </div>
                                <button @click="saveCarrierSettings('hanjin')" class="px-4 py-2 bg-gray-400 text-white rounded-lg">
                                    저장
                                </button>
                            </div>
                        </div>

                        <!-- 롯데/로젠/우체국 (접힌 상태) -->
                        <div x-data="{ showMore: false }">
                            <button @click="showMore = !showMore" class="text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1">
                                <i :class="showMore ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                <span x-text="showMore ? '다른 택배사 숨기기' : '다른 택배사 더보기 (롯데, 로젠, 우체국)'"></span>
                            </button>
                            <div x-show="showMore" x-transition class="mt-4 space-y-4">
                                <!-- 롯데택배 -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="w-3 h-3 rounded-full bg-gray-300"></span>
                                        <span class="font-medium">롯데택배</span>
                                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">추후 지원</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <input type="text" x-model="settingsForm.carriers.lotte.customer_id" placeholder="Customer ID" class="rounded-lg border-gray-300">
                                        <input type="password" x-model="settingsForm.carriers.lotte.api_key" placeholder="API Key" class="rounded-lg border-gray-300">
                                    </div>
                                </div>
                                <!-- 로젠택배 -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="w-3 h-3 rounded-full bg-gray-300"></span>
                                        <span class="font-medium">로젠택배</span>
                                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">추후 지원</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <input type="text" x-model="settingsForm.carriers.logen.customer_id" placeholder="Customer ID" class="rounded-lg border-gray-300">
                                        <input type="password" x-model="settingsForm.carriers.logen.api_key" placeholder="API Key" class="rounded-lg border-gray-300">
                                    </div>
                                </div>
                                <!-- 우체국택배 -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="w-3 h-3 rounded-full bg-gray-300"></span>
                                        <span class="font-medium">우체국택배</span>
                                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">추후 지원</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <input type="text" x-model="settingsForm.carriers.epost.customer_id" placeholder="Customer ID" class="rounded-lg border-gray-300">
                                        <input type="password" x-model="settingsForm.carriers.epost.api_key" placeholder="API Key" class="rounded-lg border-gray-300">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 토스트 알림 -->
    <div x-show="toast.show" x-transition class="fixed bottom-4 right-4 z-50">
        <div class="px-6 py-4 rounded-lg shadow-lg" 
             :class="toast.type === 'success' ? 'bg-green-500' : toast.type === 'error' ? 'bg-red-500' : 'bg-blue-500'"
             class="text-white">
            <span x-text="toast.message"></span>
        </div>
    </div>

    <!-- 상품 등록 모달 -->
    <div x-show="showAddProduct" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6" @click.away="showAddProduct = false">
            <h3 class="text-lg font-semibold mb-4">상품 등록</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">SKU *</label>
                    <input type="text" x-model="newProduct.sku" class="w-full rounded-lg border-gray-300">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">상품명 *</label>
                    <input type="text" x-model="newProduct.name" class="w-full rounded-lg border-gray-300">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">초기 재고</label>
                        <input type="number" x-model="newProduct.stock_quantity" class="w-full rounded-lg border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">가격</label>
                        <input type="number" x-model="newProduct.price" class="w-full rounded-lg border-gray-300">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">네이버 상품ID</label>
                    <input type="text" x-model="newProduct.naver_product_id" class="w-full rounded-lg border-gray-300">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">쿠팡 상품ID</label>
                    <input type="text" x-model="newProduct.coupang_product_id" class="w-full rounded-lg border-gray-300">
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-6">
                <button @click="showAddProduct = false" class="px-4 py-2 border rounded-lg">취소</button>
                <button @click="addProduct()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">등록</button>
            </div>
        </div>
    </div>

    <script>
    function app() {
        return {
            // 상태
            sidebarOpen: true,
            currentPage: 'dashboard',
            lastSync: '-',
            
            // 데이터
            dashboard: {},
            recentOrders: [],
            orders: [],
            orderPagination: { page: 1, limit: 20, total: 0, pages: 0 },
            orderFilter: { status: '', channel: '', search: '' },
            products: [],
            lowStockProducts: [],
            claims: [],
            connectionStatus: {},
            
            // 폼
            settingsForm: {
                naver: { client_id: '', client_secret: '', seller_id: '' },
                coupang: { vendor_id: '', access_key: '', secret_key: '' },
                telegram: { bot_token: '', chat_id: '' },
                schedule: { first_batch: '12:00', second_batch: '15:30', tracking_interval: 30 },
                sender: { name: '', phone: '', zipcode: '', address: '' },
                defaultCarrier: 'cj',
                carriers: {
                    cj: { customer_id: '', api_key: '', contract_code: '' },
                    hanjin: { customer_id: '', api_key: '' },
                    lotte: { customer_id: '', api_key: '' },
                    logen: { customer_id: '', api_key: '' },
                    epost: { customer_id: '', api_key: '' }
                }
            },
            carrierStatus: {
                cj: { configured: false },
                hanjin: { configured: false },
                lotte: { configured: false },
                logen: { configured: false },
                epost: { configured: false }
            },
            newProduct: { sku: '', name: '', stock_quantity: 0, price: 0, naver_product_id: '', coupang_product_id: '' },
            
            // UI
            toast: { show: false, message: '', type: 'info' },
            showAddProduct: false,
            
            async init() {
                await this.refreshData();
                await this.loadCarrierStatus();
            },
            
            async refreshData() {
                await Promise.all([
                    this.loadDashboard(),
                    this.loadRecentOrders(),
                    this.loadOrders(),
                    this.loadProducts(),
                    this.loadLowStock()
                ]);
                this.lastSync = new Date().toLocaleTimeString('ko-KR');
            },
            
            async loadDashboard() {
                try {
                    const res = await fetch('/api/v1/dashboard/summary');
                    this.dashboard = await res.json();
                } catch (e) { console.error(e); }
            },
            
            async loadRecentOrders() {
                try {
                    const res = await fetch('/api/v1/dashboard/recent-orders?limit=5');
                    this.recentOrders = await res.json();
                } catch (e) { console.error(e); }
            },
            
            async loadOrders() {
                try {
                    const params = new URLSearchParams({
                        page: this.orderPagination.page,
                        limit: this.orderPagination.limit,
                        ...this.orderFilter
                    });
                    const res = await fetch('/api/v1/orders?' + params);
                    const data = await res.json();
                    this.orders = data.orders;
                    this.orderPagination.total = data.total;
                    this.orderPagination.pages = data.pages;
                } catch (e) { console.error(e); }
            },
            
            async loadProducts() {
                try {
                    const res = await fetch('/api/v1/products?limit=100');
                    const data = await res.json();
                    this.products = data.products;
                } catch (e) { console.error(e); }
            },
            
            async loadLowStock() {
                try {
                    const res = await fetch('/api/v1/products/low-stock');
                    const data = await res.json();
                    this.lowStockProducts = data.products;
                } catch (e) { console.error(e); }
            },
            
            async collectOrders() {
                try {
                    const res = await fetch('/api/v1/orders/collect', { method: 'POST' });
                    const data = await res.json();
                    this.showToast(data.message, 'success');
                    await this.loadOrders();
                    await this.loadDashboard();
                } catch (e) { this.showToast('주문 수집 실패', 'error'); }
            },
            
            async processBatch(num) {
                if (!confirm(`${num}차 송장 처리를 실행하시겠습니까?`)) return;
                try {
                    const res = await fetch(`/api/v1/orders/process-batch/${num}`, { method: 'POST' });
                    const data = await res.json();
                    this.showToast(data.message, 'success');
                    await this.refreshData();
                } catch (e) { this.showToast('처리 실패', 'error'); }
            },
            
            async addProduct() {
                try {
                    const res = await fetch('/api/v1/products', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.newProduct)
                    });
                    const data = await res.json();
                    if (data.success) {
                        this.showToast('상품이 등록되었습니다', 'success');
                        this.showAddProduct = false;
                        this.newProduct = { sku: '', name: '', stock_quantity: 0, price: 0, naver_product_id: '', coupang_product_id: '' };
                        await this.loadProducts();
                    } else {
                        this.showToast(data.detail || '등록 실패', 'error');
                    }
                } catch (e) { this.showToast('등록 실패', 'error'); }
            },
            
            async syncStock() {
                try {
                    const res = await fetch('/api/v1/products/sync-channels', { method: 'POST' });
                    const data = await res.json();
                    this.showToast(`동기화 완료 (네이버: ${data.results.naver}, 쿠팡: ${data.results.coupang})`, 'success');
                } catch (e) { this.showToast('동기화 실패', 'error'); }
            },
            
            async syncClaims() {
                try {
                    const res = await fetch('/api/v1/claims/sync');
                    const data = await res.json();
                    this.claims = data.claims;
                    this.showToast(`${data.count}건의 클레임을 동기화했습니다`, 'success');
                } catch (e) { this.showToast('동기화 실패', 'error'); }
            },
            
            async checkConnection() {
                try {
                    const res = await fetch('/api/v1/settings/status');
                    this.connectionStatus = await res.json();
                } catch (e) { console.error(e); }
            },
            
            async saveNaverSettings() {
                try {
                    const res = await fetch('/api/v1/settings/naver', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.naver)
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                    await this.checkConnection();
                } catch (e) { this.showToast('저장 실패', 'error'); }
            },
            
            async saveCoupangSettings() {
                try {
                    const res = await fetch('/api/v1/settings/coupang', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.coupang)
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                    await this.checkConnection();
                } catch (e) { this.showToast('저장 실패', 'error'); }
            },
            
            async saveTelegramSettings() {
                try {
                    const res = await fetch('/api/v1/settings/telegram', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.telegram)
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                    await this.checkConnection();
                } catch (e) { this.showToast('저장 실패', 'error'); }
            },
            
            async saveScheduleSettings() {
                try {
                    const res = await fetch('/api/v1/settings/schedule', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.schedule)
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                } catch (e) { this.showToast('저장 실패', 'error'); }
            },

            async saveSenderSettings() {
                try {
                    const res = await fetch('/api/v1/settings/sender', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.sender)
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                } catch (e) { this.showToast('발송인 정보 저장 실패', 'error'); }
            },

            async saveDefaultCarrier() {
                try {
                    const res = await fetch('/api/v1/settings/carriers/default', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ carrier: this.settingsForm.defaultCarrier })
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                } catch (e) { this.showToast('기본 택배사 설정 실패', 'error'); }
            },

            async saveCarrierSettings(carrier) {
                try {
                    const res = await fetch(`/api/v1/settings/carriers/${carrier}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.settingsForm.carriers[carrier])
                    });
                    const data = await res.json();
                    this.showToast(data.message, data.success ? 'success' : 'error');
                    await this.loadCarrierStatus();
                } catch (e) { this.showToast('택배사 설정 저장 실패', 'error'); }
            },

            async loadCarrierStatus() {
                try {
                    const res = await fetch('/api/v1/settings/carriers');
                    const data = await res.json();
                    // Update carrier status
                    data.carriers.forEach(c => {
                        if (this.carrierStatus[c.code]) {
                            this.carrierStatus[c.code].configured = c.configured;
                        }
                    });
                    // Update default carrier
                    const defaultCarrier = data.carriers.find(c => c.is_default);
                    if (defaultCarrier) {
                        this.settingsForm.defaultCarrier = defaultCarrier.code;
                    }
                } catch (e) { console.error('택배사 상태 조회 실패:', e); }
            },

            showOrderDetail(order) {
                // TODO: 주문 상세 모달
                console.log(order);
            },
            
            showStockUpdate(product) {
                const qty = prompt(`${product.name} 재고 변경량을 입력하세요 (입고: 양수, 조정: 음수):`, '0');
                if (qty !== null) {
                    this.updateStock(product.id, parseInt(qty));
                }
            },
            
            async updateStock(productId, quantity) {
                try {
                    const res = await fetch(`/api/v1/products/${productId}/stock`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ quantity, reason: quantity > 0 ? 'incoming' : 'adjustment' })
                    });
                    const data = await res.json();
                    if (data.success) {
                        this.showToast(`재고 변경: ${data.stock.before} → ${data.stock.after}`, 'success');
                        await this.loadProducts();
                        await this.loadLowStock();
                    }
                } catch (e) { this.showToast('재고 변경 실패', 'error'); }
            },
            
            showToast(message, type = 'info') {
                this.toast = { show: true, message, type };
                setTimeout(() => { this.toast.show = false; }, 3000);
            },
            
            formatCurrency(value) {
                return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(value || 0);
            },
            
            formatDate(dateStr) {
                if (!dateStr) return '-';
                return new Date(dateStr).toLocaleString('ko-KR');
            },
            
            getStatusText(status) {
                const map = { new: '신규', confirmed: '발주확인', shipped: '발송완료', delivering: '배송중', delivered: '배송완료', cancelled: '취소' };
                return map[status] || status;
            },
            
            getStatusClass(status) {
                const map = {
                    new: 'bg-yellow-100 text-yellow-700',
                    confirmed: 'bg-blue-100 text-blue-700',
                    shipped: 'bg-purple-100 text-purple-700',
                    delivering: 'bg-indigo-100 text-indigo-700',
                    delivered: 'bg-green-100 text-green-700',
                    cancelled: 'bg-gray-100 text-gray-700'
                };
                return map[status] || 'bg-gray-100 text-gray-700';
            }
        }
    }
    </script>
</body>
</html>
